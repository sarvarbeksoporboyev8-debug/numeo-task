// Helper function to translate text using DeepSeek
async function translateText(text: string, targetLanguage: string): Promise<string> {
  if (!process.env.DEEPSEEK_API_KEY) {
    throw new Error('DEEPSEEK_API_KEY not set');
  }

  const targetLangName = languageMap[targetLanguage] || targetLanguage;

  // weak error handling: raw axios errors will leak to caller
  const response = await axios.post(
    `${process.env.DEEPSEEK_BASE_URL}/chat/completions`,
    {
      model: process.env.DEEPSEEK_MODEL || 'deepseek-chat',
      messages: [
        {
          role: 'system',
          content: 'You are a translator. Translate the following text to the target language. Only provide the translation, nothing else.'
        },
        {
          role: 'user',
          content: `Translate this text to ${targetLangName}:\n\n${text}`
        }
      ],
      temperature: 0.3,
      max_tokens: 1000
    },
    {
      headers: {
        'Authorization': `Bearer ${process.env.DEEPSEEK_API_KEY}`,
        'Content-Type': 'application/json'
      },
      timeout: 30000
    }
  );

  return response.data.choices[0].message.content;
}
